<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LRT 2 Map View</title>
    <link rel="stylesheet" href="styles/styles1.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        #map {
            width: 70%;
            height: 90vh;
            margin-left: 20px;
            margin-top: 5%;
        }
    </style>
</head>

<body>
    <div class="header">
        <a href="index.html">
             <img class="logo" src="graphics/logo-header.png" alt="Logo" id="logo">
        </a>
        <ul>
            <i class="fas fa-train" style="color: white;"></i>
            <li><a href="LRT1.html">LRT LINE 1</a></li>

            <i class="fas fa-train" style="color: white;"></i>
            <li><ab href="LRT2.html">LRT LINE 2</ab></li>
        </ul>
    </div>

    <h1>LRT 2 ROUTE MAP</h1>
    <div class="dropdown-container">
        <select id="status">
            <option value="0">Status</option>
            <option value="1">Onboarding</option>
            <option value="2">In Transit</option>
            <option value="3">Arriving</option>
            <option value="4">Under Maintenance</option>
            <option value="5">Emergency Stop</option>
        </select>
    </div>

    <div class="dropdown-station-from">
        <select id="station_from">
            <option value="0">Current Station</option>
            <option value="1">Recto</option>
            <option value="2">Legarda</option>
            <option value="3">Pureza</option>
            <option value="4">V. Mapa</option>
            <option value="5">J. Ruiz</option>
            <option value="6">Gilmore</option>
            <option value="7">Betty Go-Belmonte</option>
            <option value="8">Cubao</option>
            <option value="9">Anonas</option>
            <option value="10">Katipunan</option>
            <option value="11">Santolan</option>
            <option value="12">Marikina-Pasig</option>
            <option value="13">Antipolo</option>
        </select>
    </div>

    <div class="dropdown-station-to">
        <select id="station_to">
            <option value="0">Destination Station</option>
            <option value="1">Recto</option>
            <option value="2">Legarda</option>
            <option value="3">Pureza</option>
            <option value="4">V. Mapa</option>
            <option value="5">J. Ruiz</option>
            <option value="6">Gilmore</option>
            <option value="7">Betty Go-Belmonte</option>
            <option value="8">Cubao</option>
            <option value="9">Anonas</option>
            <option value="10">Katipunan</option>
            <option value="11">Santolan</option>
            <option value="12">Marikina-Pasig</option>
            <option value="13">Antipolo</option>
        </select>
    </div>

    <div class="accordion-container">
        <button class="accordion">Status Details</button>
        <div class="panel">
            <p>Est Time of Completion :</p>
            <p>Train ID :</p>
            <p>Details: </p>
        </div>
    </div>

    

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

    <script>
        // Accordion toggle functionality
        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            });
        }


         // Initialize the map
         var map = L.map('map').setView([14.5898, 120.9814], 13);

        // Add the OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data Â© <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 18
        }).addTo(map);

        // Define a custom icon for the train stations
        var trainStationIcon = L.icon({
            iconUrl: 'graphics/train-station.png', 
            iconSize: [32, 32], 
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        // Define the train station locations
        var trainStations = [
            { name: 'Recto', coordinates: [14.603523749575908, 120.98355536668444] },
            { name: 'Legarda', coordinates: [14.600866401813708, 120.99257584654309] },
            { name: 'Pureza', coordinates: [14.601761023215898, 121.00522612060541] },
            { name: 'V. Mapa', coordinates: [14.604127775307445, 121.01720548492453] },
            { name: 'J. Ruiz', coordinates: [14.610709314239692, 121.02620839459375] },
            { name: 'Gilmore', coordinates: [14.613779947826389, 121.03422913877083] },
            { name: 'Betty Go-Belmonte', coordinates: [14.618526233772084, 121.04271408061948] },
            { name: 'Cubao', coordinates: [14.622761948731455, 121.05259758282531] },
            { name: 'Anonas', coordinates: [14.628031938772514, 121.06467453097706] },
            { name: 'Katipunan', coordinates: [14.631115349832555, 121.0725304965648] },
            { name: 'Santolan', coordinates: [14.622634836379207, 121.08577593223578] },
            { name: 'Marikina-Pasig', coordinates: [14.62042623132183, 121.1002720967416] },
            { name: 'Antipolo', coordinates: [14.624951378644008, 121.12143178275615] }
        ];

        // Add markers and draw the polyline
        var stationCoordinates = [];
        trainStations.forEach(station => {
            L.marker(station.coordinates, { icon: trainStationIcon })
                .addTo(map)
                .bindPopup(`<b>${station.name}</b>`);

            stationCoordinates.push(station.coordinates);
        });

        // Draw a polyline connecting the train stations
        var trainRoute = L.polyline(stationCoordinates, { color: 'red', weight: 4 }).addTo(map);

        // Fit the map to the bounds of the route
        map.fitBounds(trainRoute.getBounds());


// Create an array of coordinates for the route
        var stationCoordinates = trainStations.map(station => station.coordinates);

        // Function to create custom marker icon
        function createCustomMarkerIcon(url) {
            return L.icon({
                iconUrl: url,
                iconSize: [64, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            });
        }

        // Function to animate marker along the route
        function animateMarkerAlongRoute(route) {
            var markers = [];
            var index = 0;

            // Create 9 moving markers, each starting from a different station
            for (var i = 0; i < 9; i++) {
                var marker = L.marker(route[i % route.length], { icon: createCustomMarkerIcon('graphics/train.png') }).addTo(map);
                markers.push(marker);
            }

            function moveAlongPath() {
                markers.forEach((movingMarker, markerIndex) => {
                    var currentStation = route[(index + markerIndex) % route.length];
                    var nextStation = route[(index + markerIndex + 1) % route.length];

                    var fromLatLng = L.latLng(currentStation);
                    var toLatLng = L.latLng(nextStation);

                    var duration = 2000; // Duration of movement between two points in ms
                    var startTime = null;

                    // Function to update the position of the marker during the animation
                    function animateMarkerStep(timestamp) {
                        if (!startTime) startTime = timestamp;
                        var progress = (timestamp - startTime) / duration;

                        if (progress < 1) {
                            var lat = fromLatLng.lat + (toLatLng.lat - fromLatLng.lat) * progress;
                            var lng = fromLatLng.lng + (toLatLng.lng - fromLatLng.lng) * progress;
                            movingMarker.setLatLng([lat, lng]);
                            map.setView([lat, lng], 14); // Adjust map view to follow marker

                            requestAnimationFrame(animateMarkerStep); // Continue the animation
                        } else {
                            movingMarker.setLatLng(toLatLng); // Final position
                        }
                    }

                    requestAnimationFrame(animateMarkerStep); // Start the animation for this marker
                });

                index++; // Move to the next station

                // If the index goes beyond the last station, reset to the start (but without looping back)
                if (index >= route.length) {
                    index = 0;
                }

                // Restart the animation with a slight delay before moving again
                setTimeout(moveAlongPath, 5000); // Wait for 5 seconds before moving again
            }

            moveAlongPath(); // Start the animation process
        }

        // Start the marker animation along the route
        animateMarkerAlongRoute(stationCoordinates);


            </script>
</body>

</html>
